# _*_ coding: utf-8 _*_

# Copyright (c) 2019 NMC Developers.
# Distributed under the terms of the GPL V3 License.

"""
Tropical Cyclone Markers to Matplotlib Plots
refer to https://github.com/abrammer/tc_markers
"""
import numpy as np
from numpy import array, uint8
from matplotlib import transforms
from matplotlib.markers import MarkerStyle
from matplotlib.transforms import Affine2D
from matplotlib.path import Path


# Autogenerated Paths for each marker from SVG file. 
# Don't edit manually. Edit SVG and regenerate this file. 

NH_TS_path = Path(array([[ 5.840e+00,  4.812e+01],
       [ 5.450e+00,  4.814e+01],
       [ 3.660e+00,  4.783e+01],
       [ 1.910e+00,  4.740e+01],
       [-3.290e+00,  4.610e+01],
       [-7.840e+00,  4.432e+01],
       [-1.124e+01,  4.122e+01],
       [-1.274e+01,  3.992e+01],
       [-1.561e+01,  3.701e+01],
       [-1.671e+01,  3.531e+01],
       [-2.041e+01,  2.971e+01],
       [-2.284e+01,  2.200e+01],
       [-2.384e+01,  1.400e+01],
       [-2.435e+01,  8.940e+00],
       [-2.486e+01,  4.630e+00],
       [-2.487e+01,  3.000e-02],
       [-2.473e+01, -5.200e+00],
       [-2.354e+01, -9.320e+00],
       [-2.138e+01, -1.261e+01],
       [-1.778e+01, -1.881e+01],
       [-1.086e+01, -2.339e+01],
       [-3.760e+00, -2.439e+01],
       [ 2.040e+00, -2.535e+01],
       [ 7.190e+00, -2.419e+01],
       [ 1.219e+01, -2.143e+01],
       [ 1.293e+01, -2.105e+01],
       [ 1.364e+01, -2.063e+01],
       [ 1.364e+01, -2.066e+01],
       [ 1.369e+01, -2.073e+01],
       [ 1.325e+01, -2.306e+01],
       [ 1.289e+01, -2.456e+01],
       [ 1.190e+01, -2.866e+01],
       [ 9.990e+00, -3.356e+01],
       [ 8.190e+00, -3.656e+01],
       [ 5.190e+00, -4.166e+01],
       [ 5.900e-01, -4.556e+01],
       [-4.810e+00, -4.756e+01],
       [-5.410e+00, -4.778e+01],
       [-5.910e+00, -4.802e+01],
       [-5.910e+00, -4.808e+01],
       [-5.920e+00, -4.810e+01],
       [-5.890e+00, -4.811e+01],
       [-5.840e+00, -4.812e+01],
       [-5.450e+00, -4.814e+01],
       [-3.660e+00, -4.783e+01],
       [-1.910e+00, -4.740e+01],
       [ 3.290e+00, -4.610e+01],
       [ 7.840e+00, -4.432e+01],
       [ 1.124e+01, -4.122e+01],
       [ 1.274e+01, -3.992e+01],
       [ 1.561e+01, -3.701e+01],
       [ 1.671e+01, -3.531e+01],
       [ 2.041e+01, -2.971e+01],
       [ 2.284e+01, -2.200e+01],
       [ 2.384e+01, -1.400e+01],
       [ 2.435e+01, -8.930e+00],
       [ 2.486e+01, -4.630e+00],
       [ 2.487e+01, -3.000e-02],
       [ 2.473e+01,  5.200e+00],
       [ 2.354e+01,  9.320e+00],
       [ 2.138e+01,  1.261e+01],
       [ 1.778e+01,  1.881e+01],
       [ 1.086e+01,  2.339e+01],
       [ 3.760e+00,  2.439e+01],
       [-2.040e+00,  2.535e+01],
       [-7.190e+00,  2.419e+01],
       [-1.219e+01,  2.143e+01],
       [-1.293e+01,  2.105e+01],
       [-1.364e+01,  2.063e+01],
       [-1.364e+01,  2.066e+01],
       [-1.369e+01,  2.073e+01],
       [-1.325e+01,  2.306e+01],
       [-1.289e+01,  2.456e+01],
       [-1.190e+01,  2.866e+01],
       [-9.990e+00,  3.356e+01],
       [-8.190e+00,  3.656e+01],
       [-5.190e+00,  4.166e+01],
       [-5.900e-01,  4.556e+01],
       [ 4.810e+00,  4.756e+01],
       [ 5.410e+00,  4.778e+01],
       [ 5.910e+00,  4.802e+01],
       [ 5.910e+00,  4.808e+01],
       [ 5.920e+00,  4.810e+01],
       [ 5.890e+00,  4.811e+01],
       [ 5.840e+00,  4.812e+01],
       [ 5.840e+00,  4.812e+01],
       [ 5.840e+00,  4.812e+01],
       [ 4.000e-02,  1.395e+01],
       [ 7.780e+00,  1.395e+01],
       [ 1.404e+01,  7.690e+00],
       [ 1.404e+01, -4.000e-02],
       [ 1.406e+01, -4.000e-02],
       [ 1.406e+01, -1.430e+00],
       [ 1.385e+01, -2.770e+00],
       [ 1.347e+01, -4.040e+00],
       [ 1.175e+01, -9.810e+00],
       [ 6.390e+00, -1.401e+01],
       [ 6.000e-02, -1.401e+01],
       [-6.270e+00, -1.401e+01],
       [-1.162e+01, -9.810e+00],
       [-1.335e+01, -4.040e+00],
       [-1.373e+01, -2.760e+00],
       [-1.394e+01, -1.410e+00],
       [-1.394e+01, -2.000e-02],
       [-1.395e+01, -2.000e-02],
       [-1.394e+01,  7.700e+00],
       [-7.670e+00,  1.395e+01],
       [ 4.000e-02,  1.395e+01],
       [ 4.000e-02,  1.395e+01]]), array([ 1,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,
        4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,
        4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,
        4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,
        4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,
        2, 79,  1,  4,  4,  4,  2,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,
        4,  4,  2,  4,  4,  4, 79], dtype=uint8))

NH_HU_path = Path(array([[ 5.840e+00,  4.812e+01],
       [ 5.450e+00,  4.814e+01],
       [ 3.660e+00,  4.783e+01],
       [ 1.910e+00,  4.740e+01],
       [-3.290e+00,  4.610e+01],
       [-7.840e+00,  4.432e+01],
       [-1.124e+01,  4.122e+01],
       [-1.274e+01,  3.992e+01],
       [-1.561e+01,  3.701e+01],
       [-1.671e+01,  3.531e+01],
       [-2.041e+01,  2.971e+01],
       [-2.284e+01,  2.200e+01],
       [-2.384e+01,  1.400e+01],
       [-2.435e+01,  8.940e+00],
       [-2.486e+01,  4.630e+00],
       [-2.487e+01,  3.000e-02],
       [-2.473e+01, -5.200e+00],
       [-2.354e+01, -9.320e+00],
       [-2.138e+01, -1.261e+01],
       [-1.778e+01, -1.881e+01],
       [-1.086e+01, -2.339e+01],
       [-3.760e+00, -2.439e+01],
       [ 2.040e+00, -2.535e+01],
       [ 7.190e+00, -2.419e+01],
       [ 1.219e+01, -2.143e+01],
       [ 1.293e+01, -2.105e+01],
       [ 1.364e+01, -2.063e+01],
       [ 1.364e+01, -2.066e+01],
       [ 1.369e+01, -2.073e+01],
       [ 1.325e+01, -2.306e+01],
       [ 1.289e+01, -2.456e+01],
       [ 1.190e+01, -2.866e+01],
       [ 9.990e+00, -3.356e+01],
       [ 8.190e+00, -3.656e+01],
       [ 5.190e+00, -4.166e+01],
       [ 5.900e-01, -4.556e+01],
       [-4.810e+00, -4.756e+01],
       [-5.410e+00, -4.778e+01],
       [-5.910e+00, -4.802e+01],
       [-5.910e+00, -4.808e+01],
       [-5.920e+00, -4.810e+01],
       [-5.890e+00, -4.811e+01],
       [-5.840e+00, -4.812e+01],
       [-5.450e+00, -4.814e+01],
       [-3.660e+00, -4.783e+01],
       [-1.910e+00, -4.740e+01],
       [ 3.290e+00, -4.610e+01],
       [ 7.840e+00, -4.432e+01],
       [ 1.124e+01, -4.122e+01],
       [ 1.274e+01, -3.992e+01],
       [ 1.561e+01, -3.701e+01],
       [ 1.671e+01, -3.531e+01],
       [ 2.041e+01, -2.971e+01],
       [ 2.284e+01, -2.200e+01],
       [ 2.384e+01, -1.400e+01],
       [ 2.435e+01, -8.930e+00],
       [ 2.486e+01, -4.630e+00],
       [ 2.487e+01, -3.000e-02],
       [ 2.473e+01,  5.200e+00],
       [ 2.354e+01,  9.320e+00],
       [ 2.138e+01,  1.261e+01],
       [ 1.778e+01,  1.881e+01],
       [ 1.086e+01,  2.339e+01],
       [ 3.760e+00,  2.439e+01],
       [-2.040e+00,  2.535e+01],
       [-7.190e+00,  2.419e+01],
       [-1.219e+01,  2.143e+01],
       [-1.293e+01,  2.105e+01],
       [-1.364e+01,  2.063e+01],
       [-1.364e+01,  2.066e+01],
       [-1.369e+01,  2.073e+01],
       [-1.325e+01,  2.306e+01],
       [-1.289e+01,  2.456e+01],
       [-1.190e+01,  2.866e+01],
       [-9.990e+00,  3.356e+01],
       [-8.190e+00,  3.656e+01],
       [-5.190e+00,  4.166e+01],
       [-5.900e-01,  4.556e+01],
       [ 4.810e+00,  4.756e+01],
       [ 5.410e+00,  4.778e+01],
       [ 5.910e+00,  4.802e+01],
       [ 5.910e+00,  4.808e+01],
       [ 5.920e+00,  4.810e+01],
       [ 5.890e+00,  4.811e+01],
       [ 5.840e+00,  4.812e+01],
       [ 5.840e+00,  4.812e+01],
       [ 5.840e+00,  4.812e+01]]), array([ 1,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,
        4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,
        4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,
        4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,
        4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,
        2, 79], dtype=uint8))

TD_path = Path(array([[  0.  ,  24.7 ],
       [  0.  ,  24.7 ],
       [ -6.57,  24.7 ],
       [-12.89,  22.1 ],
       [-17.54,  17.47],
       [-22.18,  12.84],
       [-24.8 ,   6.55],
       [-24.8 ,   0.  ],
       [-24.8 ,   0.  ],
       [-24.8 ,  -3.24],
       [-24.16,  -6.46],
       [-22.91,  -9.45],
       [-21.67, -12.45],
       [-19.84, -15.17],
       [-17.54, -17.47],
       [-15.23, -19.76],
       [-12.5 , -21.58],
       [ -9.49, -22.82],
       [ -6.48, -24.06],
       [ -3.26, -24.7 ],
       [  0.  , -24.7 ],
       [  0.  , -24.7 ],
       [  3.26, -24.7 ],
       [  6.48, -24.06],
       [  9.49, -22.82],
       [ 12.5 , -21.58],
       [ 15.23, -19.76],
       [ 17.54, -17.46],
       [ 19.84, -15.17],
       [ 21.67, -12.45],
       [ 22.91,  -9.45],
       [ 24.16,  -6.45],
       [ 24.8 ,  -3.24],
       [ 24.8 ,   0.  ],
       [ 24.8 ,   0.  ],
       [ 24.8 ,   6.55],
       [ 22.19,  12.84],
       [ 17.54,  17.47],
       [ 12.89,  22.1 ],
       [  6.58,  24.7 ],
       [  0.  ,  24.7 ],
       [  0.  ,  24.7 ],
       [  0.22,  13.89],
       [  0.22,  13.89],
       [  3.93,  13.89],
       [  7.49,  12.41],
       [ 10.12,   9.79],
       [ 12.74,   7.16],
       [ 14.22,   3.6 ],
       [ 14.22,  -0.11],
       [ 14.22,  -0.11],
       [ 14.22,  -3.83],
       [ 12.74,  -7.39],
       [ 10.12, -10.01],
       [  7.49, -12.64],
       [  3.93, -14.11],
       [  0.22, -14.11],
       [  0.22, -14.11],
       [ -3.49, -14.11],
       [ -7.06, -12.64],
       [ -9.68, -10.01],
       [-12.3 ,  -7.39],
       [-13.78,  -3.83],
       [-13.78,  -0.11],
       [-13.78,  -0.11],
       [-13.78,   3.6 ],
       [-12.3 ,   7.16],
       [ -9.68,   9.79],
       [ -7.06,  12.41],
       [ -3.49,  13.89],
       [  0.22,  13.89],
       [  0.22,  13.89]]), array([ 1,  2,  4,  4,  4,  4,  4,  4,  2,  4,  4,  4,  4,  4,  4,  4,  4,
        4,  4,  4,  4,  2,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,
        2,  4,  4,  4,  4,  4,  4, 79,  1,  2,  4,  4,  4,  4,  4,  4,  2,
        4,  4,  4,  4,  4,  4,  2,  4,  4,  4,  4,  4,  4,  2,  4,  4,  4,
        4,  4,  4, 79], dtype=uint8))

EX_path = Path(array([[  0.  ,  24.7 ],
       [  0.  ,  24.7 ],
       [ -6.57,  24.7 ],
       [-12.89,  22.1 ],
       [-17.54,  17.47],
       [-22.18,  12.84],
       [-24.8 ,   6.55],
       [-24.8 ,   0.  ],
       [-24.8 ,   0.  ],
       [-24.8 ,  -3.24],
       [-24.16,  -6.46],
       [-22.91,  -9.45],
       [-21.67, -12.45],
       [-19.84, -15.17],
       [-17.54, -17.47],
       [-15.23, -19.76],
       [-12.5 , -21.58],
       [ -9.49, -22.82],
       [ -6.48, -24.06],
       [ -3.26, -24.7 ],
       [  0.  , -24.7 ],
       [  0.  , -24.7 ],
       [  3.26, -24.7 ],
       [  6.48, -24.06],
       [  9.49, -22.82],
       [ 12.5 , -21.58],
       [ 15.23, -19.76],
       [ 17.54, -17.46],
       [ 19.84, -15.17],
       [ 21.67, -12.45],
       [ 22.91,  -9.45],
       [ 24.16,  -6.45],
       [ 24.8 ,  -3.24],
       [ 24.8 ,   0.  ],
       [ 24.8 ,   0.  ],
       [ 24.8 ,   6.55],
       [ 22.19,  12.84],
       [ 17.54,  17.47],
       [ 12.89,  22.1 ],
       [  6.58,  24.7 ],
       [  0.  ,  24.7 ],
       [  0.  ,  24.7 ],
       [  0.22,  13.89],
       [  0.22,  13.89],
       [  1.6 ,  13.89],
       [  2.97,  13.68],
       [  4.29,  13.28],
       [  5.61,  12.88],
       [  6.87,  12.28],
       [  8.01,  11.52],
       [  0.2 ,   3.7 ],
       [ -7.59,  11.5 ],
       [ -7.59,  11.5 ],
       [ -6.45,  12.27],
       [ -5.19,  12.87],
       [ -3.87,  13.27],
       [ -2.54,  13.68],
       [ -1.16,  13.88],
       [  0.22,  13.89],
       [  0.22,  13.89],
       [ 11.6 ,   8.03],
       [ 11.6 ,   8.03],
       [ 12.44,   6.85],
       [ 13.1 ,   5.55],
       [ 13.55,   4.16],
       [ 13.99,   2.78],
       [ 14.22,   1.34],
       [ 14.22,  -0.11],
       [ 14.22,  -0.11],
       [ 14.22,  -1.5 ],
       [ 14.01,  -2.87],
       [ 13.61,  -4.2 ],
       [ 13.2 ,  -5.52],
       [ 12.6 ,  -6.78],
       [ 11.83,  -7.93],
       [  3.74,   0.17],
       [ 11.6 ,   8.03],
       [ 11.6 ,   8.03],
       [-11.16,   7.99],
       [ -3.34,   0.17],
       [-11.41,  -7.91],
       [-11.41,  -7.91],
       [-12.18,  -6.76],
       [-12.77,  -5.51],
       [-13.17,  -4.19],
       [-13.58,  -2.87],
       [-13.78,  -1.49],
       [-13.78,  -0.11],
       [-13.78,  -0.11],
       [-13.77,   1.33],
       [-13.54,   2.77],
       [-13.1 ,   4.14],
       [-12.65,   5.52],
       [-12.  ,   6.81],
       [-11.16,   7.99],
       [-11.16,   7.99],
       [-11.16,   7.99],
       [  0.2 ,  -3.37],
       [  8.32, -11.49],
       [  8.32, -11.49],
       [  7.15, -12.33],
       [  5.85, -12.99],
       [  4.48, -13.43],
       [  3.1 , -13.88],
       [  1.66, -14.11],
       [  0.22, -14.11],
       [  0.22, -14.11],
       [ -1.23, -14.11],
       [ -2.67, -13.88],
       [ -4.05, -13.43],
       [ -5.43, -12.98],
       [ -6.73, -12.32],
       [ -7.91, -11.47],
       [  0.2 ,  -3.37],
       [  0.2 ,  -3.37]]), array([ 1,  2,  4,  4,  4,  4,  4,  4,  2,  4,  4,  4,  4,  4,  4,  4,  4,
        4,  4,  4,  4,  2,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,
        2,  4,  4,  4,  4,  4,  4, 79,  1,  2,  4,  4,  4,  4,  4,  4,  2,
        2,  2,  4,  4,  4,  4,  4,  4, 79,  1,  2,  4,  4,  4,  4,  4,  4,
        2,  4,  4,  4,  4,  4,  4,  2,  2, 79,  1,  2,  2,  2,  4,  4,  4,
        4,  4,  4,  2,  4,  4,  4,  4,  4,  4,  2, 79,  1,  2,  2,  4,  4,
        4,  4,  4,  4,  2,  4,  4,  4,  4,  4,  4,  2, 79], dtype=uint8))


#
# TC markers function
#

_MARKERSCALE = np.max(np.abs(NH_HU_path.vertices))

class TCMarkerStyle(MarkerStyle):
    def _set_custom_marker(self, path):
        self._transform = Affine2D().scale(1. / _MARKERSCALE)
        self._path = path

NH_HU = HU = TCMarkerStyle(NH_HU_path)
NH_TS = TS = TCMarkerStyle(NH_TS_path)
SH_TS = TCMarkerStyle(NH_TS_path.transformed(transforms.Affine2D().scale(-1, 1)))
SH_HU = TCMarkerStyle(NH_HU_path.transformed(transforms.Affine2D().scale(-1, 1)))

HU = NH_HU
TS = NH_TS

TD = TCMarkerStyle(TD_path)
NH_TD = TD
SH_TD = TD

EX = TCMarkerStyle(EX_path)
NH_EX = EX
SH_EX = EX

def tc_marker(vmx, lat=5):
    """ Returns marker for given intensity and latitude
    Parameters
    ----------
    vmx : num
        Intensity of storm in kts
    lat : num, optional
        latitude of storm (to decide on SH orientation), by default 5
    Returns
    -------
    matplotlib.path.Path or str
        custom Path for TS or HU strength, or plain 'o' for <= 33 kt
    Raises
    ------
    ValueError
        if vmx is too great (< 500 kts), raise error as something is wrong
    """
    import bisect
    limits = [34, 64, 500]
    if lat < 0:
        marks = [TD, SH_TS, SH_HU]
    else:
        marks = [TD, NH_TS, NH_HU]

    idx = bisect.bisect_right(limits, vmx)
    try:
        mark = marks[idx]
    except IndexError:
        raise ValueError("%d too high for dynamic marker choice x<500" % vmx)
    return mark


# import matplotlib.pyplot as plt
# import tcmarkers

# fig = plt.figure()
# ax = fig.add_subplot(111)
# marker_kwargs = {'markersize': 25, 'color':'r', 'markeredgecolor':'r'}
# ax.plot(0.35, 0.25, marker=tcmarkers.EX, **marker_kwargs)
# ax.plot(0.35, 0.20, marker=tcmarkers.SH_EX, **marker_kwargs)
# ax.plot(0.3, 0.25, marker=tcmarkers.HU, **marker_kwargs)
# ax.plot(0.3, 0.20, marker=tcmarkers.SH_HU, **marker_kwargs)
# ax.plot(0.25, 0.25, marker=tcmarkers.TS,**marker_kwargs)
# ax.plot(0.25, 0.20, marker=tcmarkers.SH_TS, **marker_kwargs)
# ax.plot(0.20, 0.25, marker=tcmarkers.TD, **marker_kwargs)
# ax.plot(0.20, 0.20, marker=tcmarkers.SH_TD, **marker_kwargs)
# fig.show()